<br><br>
</div>
</div>
<!--end page wrapper -->
<!--start overlay-->
<div class="overlay toggle-icon"></div>
<!--end overlay-->
<!--Start Back To Top Button-->
<!-- <a href="javaScript:;" class="back-to-top"><i class='bx bxs-up-arrow-alt'></i></a> -->
<!--End Back To Top Button-->
<footer class="page-footer">
    <!-- <p class="mb-0">Desarrollado por <a style="color: orangered" href="https://santandervalleycol.com/">Santander Valley Col. © </a><?php echo date('Y'); ?></p> -->
    <button id="chatBtn" class="btn btn-primary"><i class="fas fa-comment"></i></button>
    <style>
        /* styles.css */
        #chatBtn {
            position: fixed;
            bottom: 12px;
            right: 20px;
            z-index: 200;
        }
    </style>

    <div class="d-grid gap-2 d-md-flex justify-content-md-center">
        <a href="<?php echo BASE_URL . 'ventas'; ?>" class="btn btn-outline-primary me-md-2 custombtn" type="button">Nueva venta</a>
        <a href="<?php echo BASE_URL . 'cajas'; ?>" class="btn btn-success custombtn2 fw-bolder" type="button">Ir a caja</a>
    </div>
</footer>
</div>
<!--end wrapper-->
<!-- start switcher-->
<!-- <div class="switcher-wrapper">
    <div class="switcher-btn"> <i class='bx bx-cog bx-spin'></i>
    </div>
    <div class="switcher-body">
        <div class="d-flex align-items-center">
            <h5 class="mb-0 text-uppercase">Theme Customizer</h5>
            <button type="button" class="btn-close ms-auto close-switcher" aria-label="Close"></button>
        </div>
        <hr />
        <h6 class="mb-0">Theme Styles</h6>
        <hr />
        <div class="d-flex align-items-center justify-content-between">
            <div class="form-check">
                <input class="form-check-input" type="radio" name="flexRadioDefault" id="lightmode" checked>
                <label class="form-check-label" for="lightmode">Light</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="flexRadioDefault" id="darkmode">
                <label class="form-check-label" for="darkmode">Dark</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="flexRadioDefault" id="semidark">
                <label class="form-check-label" for="semidark">Semi Dark</label>
            </div>
        </div>
        <hr />
        <div class="form-check">
            <input class="form-check-input" type="radio" id="minimaltheme" name="flexRadioDefault">
            <label class="form-check-label" for="minimaltheme">Minimal Theme</label>
        </div>
        <hr />
        <h6 class="mb-0">Header Colors</h6>
        <hr />
        <div class="header-colors-indigators">
            <div class="row row-cols-auto g-3">
                <div class="col">
                    <div class="indigator headercolor1" id="headercolor1"></div>
                </div>
                <div class="col">
                    <div class="indigator headercolor2" id="headercolor2"></div>
                </div>
                <div class="col">
                    <div class="indigator headercolor3" id="headercolor3"></div>
                </div>
                <div class="col">
                    <div class="indigator headercolor4" id="headercolor4"></div>
                </div>
                <div class="col">
                    <div class="indigator headercolor5" id="headercolor5"></div>
                </div>
                <div class="col">
                    <div class="indigator headercolor6" id="headercolor6"></div>
                </div>
                <div class="col">
                    <div class="indigator headercolor7" id="headercolor7"></div>
                </div>
                <div class="col">
                    <div class="indigator headercolor8" id="headercolor8"></div>
                </div>
            </div>
        </div>
        <hr />
        <h6 class="mb-0">Sidebar Colors</h6>
        <hr />
        <div class="header-colors-indigators">
            <div class="row row-cols-auto g-3">
                <div class="col">
                    <div class="indigator sidebarcolor1" id="sidebarcolor1"></div>
                </div>
                <div class="col">
                    <div class="indigator sidebarcolor2" id="sidebarcolor2"></div>
                </div>
                <div class="col">
                    <div class="indigator sidebarcolor3" id="sidebarcolor3"></div>
                </div>
                <div class="col">
                    <div class="indigator sidebarcolor4" id="sidebarcolor4"></div>
                </div>
                <div class="col">
                    <div class="indigator sidebarcolor5" id="sidebarcolor5"></div>
                </div>
                <div class="col">
                    <div class="indigator sidebarcolor6" id="sidebarcolor6"></div>
                </div>
                <div class="col">
                    <div class="indigator sidebarcolor7" id="sidebarcolor7"></div>
                </div>
                <div class="col">
                    <div class="indigator sidebarcolor8" id="sidebarcolor8"></div>
                </div>
            </div>
        </div>
    </div>
</div> -->
<!--end switcher -->




<!-- Bootstrap JS -->
<script src="<?php echo BASE_URL; ?>assets/js/bootstrap.bundle.min.js"></script>
<!--plugins-->
<script src="<?php echo BASE_URL; ?>assets/js/jquery.min.js"></script>
<script src="<?php echo BASE_URL; ?>assets/plugins/simplebar/js/simplebar.min.js"></script>
<script src="<?php echo BASE_URL; ?>assets/plugins/metismenu/js/metisMenu.min.js"></script>
<script src="<?php echo BASE_URL; ?>assets/plugins/perfect-scrollbar/js/perfect-scrollbar.js"></script>
<script src="<?php echo BASE_URL; ?>assets/plugins/chartjs/js/Chart.min.js"></script>
<script src="<?php echo BASE_URL; ?>assets/plugins/chartjs/js/Chart.extension.js"></script>
<!--app JS-->
<script src="<?php echo BASE_URL; ?>assets/js/app.js"></script>
<script src="<?php echo BASE_URL; ?>assets/js/all.min.js"></script>
<script src="<?php echo BASE_URL; ?>assets/DataTables/datatables.min.js"></script>
<script src="<?php echo BASE_URL; ?>assets/js/botones-perzonalizados.js"></script>
<script src="<?php echo BASE_URL; ?>assets/js/sweetalert2.all.min.js"></script>
<script src="<?php echo BASE_URL; ?>assets/js/ckeditor.js"></script>
<script src="<?php echo BASE_URL; ?>assets/js/funciones.js"></script>
<script src="<?php echo BASE_URL; ?>assets/js/jquery-ui.min.js"></script>
<script src="<?php echo BASE_URL; ?>assets/plugins/fullcalendar/js/main.min.js"></script>
<script src="<?php echo BASE_URL; ?>assets/js/es.js"></script>
<script>
    const base_url = '<?php echo BASE_URL; ?>';
</script>
<?php if (!empty($data['busqueda'])) { ?>
    <script>
        const nombreKey = '<?php echo $data['carrito']; ?>';
    </script>
    <script src="<?php echo BASE_URL . 'assets/js/' . $data['busqueda']; ?>"></script>
<?php } ?>
<?php if (!empty($data['script'])) { ?>
    <script src="<?php echo BASE_URL . 'assets/js/modulos/' . $data['script']; ?>"></script>
<?php } ?>





<div class="modal fade" id="chatModal" tabindex="-1" aria-labelledby="chatModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header border border-0">
                <h2 class="modal-title" id="chatModalLabel">Mi asistente</h2>
            </div>
            <div class="modal-body">
                <?php
      
                $servername = "localhost";
                $username = "root";
                $password = "";
                $dbname = "sistema";


                $conn = new mysqli($servername, $username, $password, $dbname);

           
                if ($conn->connect_error) {
                    die("Conexión fallida: " . $conn->connect_error);
                }

           
                $sql_stock_alto_count = "SELECT COUNT(*) AS count FROM productos WHERE cantidad > 90";
                $result_stock_alto_count = $conn->query($sql_stock_alto_count);
                $row_stock_alto_count = $result_stock_alto_count->fetch_assoc();
                $count_stock_alto = $row_stock_alto_count["count"];
                $sql_stock_bajo_count = "SELECT COUNT(*) AS count FROM productos WHERE cantidad < 5";
                $result_stock_bajo_count = $conn->query($sql_stock_bajo_count);
                $row_stock_bajo_count = $result_stock_bajo_count->fetch_assoc();
                $count_stock_bajo = $row_stock_bajo_count["count"];

               
                if ($count_stock_alto > 0) {
             
                    $api_chatgpt = 'sk-proj-hXr66e9ndZldWGo7vcgrT3BlbkFJ9yNAoiG5JQHRxxxRhhIb';

                    $ch = curl_init();
                    curl_setopt($ch, CURLOPT_URL, 'https://api.openai.com/v1/chat/completions');
                    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
                    curl_setopt($ch, CURLOPT_CUSTOMREQUEST, 'POST');
                    curl_setopt($ch, CURLOPT_HTTPHEADER, [
                        'Content-Type: application/json',
                        'Authorization: Bearer ' . $api_chatgpt,
                    ]);
                    curl_setopt($ch, CURLOPT_POSTFIELDS, "{\n     \"model\": \"gpt-3.5-turbo\",\n     \"messages\": [{\"role\": \"user\", \"content\": \"Estos productos no se están vendiendo en mi fruver Imagina que eres el propietario de una fruver de barrio en colomnia  y quieres aumentar tus ventas.creame una  en menos de 400 caracteres estrategia personalizada, para vender la  amplia gama de productos y ayudame con ideas para  las ofertas especiales, para atraer a más clientes locales y aumentar el volumen de ventas en tu tienda\"}],\n     \"temperature\": 0.7\n   }");
                    $response = curl_exec($ch);
                    curl_close($ch);

                    $respuesta_stock_alto = json_decode($response);

                  
                    if (isset($respuesta_stock_alto->choices[0]->message->content)) {
                        $mensaje_respuesta_stock_alto = $respuesta_stock_alto->choices[0]->message->content;

                 
                        echo '<div class="card" id="stock-alto-card">';
                        echo '<div class="card-body">';
                        echo '<h5 class="card-title">Resumen de Stock</h5>';
                        echo '<p class="card-text">Productos con stock alto: <span class="badge bg-primary" id="stock-alto-count">' . $count_stock_alto . '</span></p>';
                        echo '<p class="card-text">Mensaje para productos con stock alto:</p>';
                        echo '<p class="card-text" id="mensaje-stock-alto">' . $mensaje_respuesta_stock_alto . '</p>'; 
                        echo '</div>';
                        echo '</div>';
                    } else {
                        echo '<div class="alert alert-warning" role="alert">';
                        echo "No se pudo obtener la respuesta para los productos con stock alto.";
                        echo '</div>';
                    }
                }

       
                if ($count_stock_bajo > 0) {

                    $ch = curl_init();
                    curl_setopt($ch, CURLOPT_URL, 'https://api.openai.com/v1/chat/completions');
                    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
                    curl_setopt($ch, CURLOPT_CUSTOMREQUEST, 'POST');
                    curl_setopt($ch, CURLOPT_HTTPHEADER, [
                        'Content-Type: application/json',
                        'Authorization: Bearer ' . $api_chatgpt,
                    ]);
                    curl_setopt($ch, CURLOPT_POSTFIELDS, "{\n     \"model\": \"gpt-3.5-turbo\",\n     \"messages\": [{\"role\": \"user\", \"content\": \"Porque es importante tener en cuenta los productos con bajo stock en el inventario de mi drogeria dame un consejos, 400 caracteres\"}],\n     \"temperature\": 0.7\n   }");
                    $response = curl_exec($ch);
                    curl_close($ch);

                    $respuesta_stock_bajo = json_decode($response);

                   
                    if (isset($respuesta_stock_bajo->choices[0]->message->content)) {
                        $mensaje_respuesta_stock_bajo = $respuesta_stock_bajo->choices[0]->message->content;

                        echo '<div class="card mt-3" id="stock-bajo-card">';
                        echo '<div class="card-body">';
                        echo '<h5 class="card-title">Resumen de Stock</h5>';
                        echo '<p class="card-text">Productos con stock bajo: <span class="badge bg-warning" id="stock-bajo-count">' . $count_stock_bajo . '</span></p>';
                        echo '<p class="card-text">Mensaje para productos con stock bajo:</p>';
                        echo '<p class="card-text" id="mensaje-stock-bajo">' . $mensaje_respuesta_stock_bajo . '</p>'; 
                        echo '</div>';
                        echo '</div>';
                    } else {
                        echo '<div class="alert alert-warning mt-3" role="alert">';
                        echo "No se pudo obtener la respuesta para los productos con stock bajo.";
                        echo '</div>';
                    }
                }

                $conn->close();
                ?>

                <script>
                    setInterval(function() {
                       
                        var api_chatgpt = 'sk-proj-hXr66e9ndZldWGo7vcgrT3BlbkFJ9yNAoiG5JQHRxxxRhhIb';

                    
                        var ch1 = curl_init();
                        curl_setopt(ch1, CURLOPT_URL, 'https://api.openai.com/v1/chat/completions');
                        curl_setopt(ch1, CURLOPT_RETURNTRANSFER, true);
                        curl_setopt(ch1, CURLOPT_CUSTOMREQUEST, 'POST');
                        curl_setopt(ch1, CURLOPT_HTTPHEADER, [
                            'Content-Type: application/json',
                            'Authorization: Bearer ' + api_chatgpt,
                        ]);
                        curl_setopt(ch1, CURLOPT_POSTFIELDS, JSON.stringify({
                            "model": "gpt-3.5-turbo",   
                            "messages": [{
                                "role": "user",
                                "content": "Estos productos no se están vendiendo en mi fruver Imagina que eres el propietario de una fruver de barrio en colomnia  y quieres aumentar tus ventas.creame una  en menos de 400 caracteres estrategia personalizada, para vender la  amplia gama de productos y ayudame con ideas para  las ofertas especiales, para atraer a más clientes locales y aumentar el volumen de ventas en tu tienda"
                            }],
                            "temperature": 0.7
                        }));
                        var response1 = curl_exec(ch1);
                        curl_close(ch1);
                        var respuesta_stock_alto = JSON.parse(response1);

                        if (respuesta_stock_alto && respuesta_stock_alto.choices && respuesta_stock_alto.choices.length > 0 && respuesta_stock_alto.choices[0].message && respuesta_stock_alto.choices[0].message.content) {
                            document.getElementById("mensaje-stock-alto").innerHTML = respuesta_stock_alto.choices[0].message.content;
                        }

                        var ch2 = curl_init();
                        curl_setopt(ch2, CURLOPT_URL, 'https://api.openai.com/v1/chat/completions');
                        curl_setopt(ch2, CURLOPT_RETURNTRANSFER, true);
                        curl_setopt(ch2, CURLOPT_CUSTOMREQUEST, 'POST');
                        curl_setopt(ch2, CURLOPT_HTTPHEADER, [
                            'Content-Type: application/json',
                            'Authorization: Bearer ' + api_chatgpt,
                        ]);
                        curl_setopt(ch2, CURLOPT_POSTFIELDS, JSON.stringify({
                            "model": "gpt-3.5-turbo",
                            "messages": [{
                                "role": "user",
                                "content": "Porque es importante tener en cuenta los productos con bajo stock en el inventario de mi fruver dame un consejos, 400 caracteres"
                            }],
                            "temperature": 0.7
                        }));
                        var response2 = curl_exec(ch2);
                        curl_close(ch2);
                        var respuesta_stock_bajo = JSON.parse(response2);

                        if (respuesta_stock_bajo && respuesta_stock_bajo.choices && respuesta_stock_bajo.choices.length > 0 && respuesta_stock_bajo.choices[0].message && respuesta_stock_bajo.choices[0].message.content) {
                            document.getElementById("mensaje-stock-bajo").innerHTML = respuesta_stock_bajo.choices[0].message.content;
                        }
                    }, 10000); 
                </script>
            </div>
        </div>
    </div>
</div>





<script>
    document.addEventListener("DOMContentLoaded", function() {
        var chatBtn = document.getElementById("chatBtn");
        var modal = document.getElementById("chatModal");

        chatBtn.addEventListener("click", function() {
            $(modal).modal("show");
        });
    });
</script>


</body>

</html>